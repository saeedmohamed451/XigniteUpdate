(function(c){var d=function(){var a={},aI,W=65,aq,U='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',ai={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},aa=function(g,e){var f=aB(g);c(e).data("colorpicker").fields.eq(1).val(f.r).end().eq(2).val(f.g).end().eq(3).val(f.b).end()},ap=function(f,e){c(e).data("colorpicker").fields.eq(4).val(f.h).end().eq(5).val(f.s).end().eq(6).val(f.b).end()},aE=function(f,e){c(e).data("colorpicker").fields.eq(0).val(b(f)).end()},az=function(f,e){c(e).data("colorpicker").selector.css("backgroundColor","#"+b({h:f.h,s:100,b:100}));c(e).data("colorpicker").selectorIndic.css({left:parseInt(150*f.s/100,10),top:parseInt(150*(100-f.b)/100,10)})},ad=function(f,e){c(e).data("colorpicker").hue.css("top",parseInt(150-150*f.h/360,10))},aD=function(f,e){c(e).data("colorpicker").currentColor.css("backgroundColor","#"+b(f))},af=function(f,e){c(e).data("colorpicker").newColor.css("backgroundColor","#"+b(f))},ax=function(g){var e=g.charCode||g.keyCode||-1;if((e>W&&e<=90)||e==32){return false}var f=c(this).parent().parent();if(f.data("colorpicker").livePreview===true){aG.apply(this)}},aG=function(f){var e=c(this).parent().parent(),g;if(this.parentNode.className.indexOf("_hex")>0){e.data("colorpicker").color=g=ay(al(this.value))}else{if(this.parentNode.className.indexOf("_hsb")>0){e.data("colorpicker").color=g=aF({h:parseInt(e.data("colorpicker").fields.eq(4).val(),10),s:parseInt(e.data("colorpicker").fields.eq(5).val(),10),b:parseInt(e.data("colorpicker").fields.eq(6).val(),10)})}else{e.data("colorpicker").color=g=aC(X({r:parseInt(e.data("colorpicker").fields.eq(1).val(),10),g:parseInt(e.data("colorpicker").fields.eq(2).val(),10),b:parseInt(e.data("colorpicker").fields.eq(3).val(),10)}))}}if(f){aa(g,e.get(0));aE(g,e.get(0));ap(g,e.get(0))}az(g,e.get(0));ad(g,e.get(0));af(g,e.get(0));e.data("colorpicker").onChange.apply(e,[g,b(g),aB(g)])},aw=function(f){var e=c(this).parent().parent();e.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},Z=function(){W=this.parentNode.className.indexOf("_hex")>0?70:65;c(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus");c(this).parent().addClass("colorpicker_focus")},ab=function(g){var e=c(this).parent().find("input").focus();var f={el:c(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:(this.parentNode.className.indexOf("_hsb")>0?100:255),y:g.pageY,field:e,val:parseInt(e.val(),10),preview:c(this).parent().parent().data("colorpicker").livePreview};c(document).bind("mouseup",f,ar);c(document).bind("mousemove",f,Y)},Y=function(e){e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10))));if(e.data.preview){aG.apply(e.data.field.get(0),[true])}return false},ar=function(e){aG.apply(e.data.field.get(0),[true]);e.data.el.removeClass("colorpicker_slider").find("input").focus();c(document).unbind("mouseup",ar);c(document).unbind("mousemove",Y);return false},an=function(f){var e={cal:c(this).parent(),y:c(this).offset().top};e.preview=e.cal.data("colorpicker").livePreview;c(document).bind("mouseup",e,at);c(document).bind("mousemove",e,aA)},aA=function(e){aG.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(e.pageY-e.data.y))))/150,10)).get(0),[e.data.preview]);return false},at=function(e){aa(e.data.cal.data("colorpicker").color,e.data.cal.get(0));aE(e.data.cal.data("colorpicker").color,e.data.cal.get(0));c(document).unbind("mouseup",at);c(document).unbind("mousemove",aA);return false},am=function(f){var e={cal:c(this).parent(),pos:c(this).offset()};e.preview=e.cal.data("colorpicker").livePreview;c(document).bind("mouseup",e,aj);c(document).bind("mousemove",e,au)},au=function(e){aG.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(e.pageY-e.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(e.pageX-e.data.pos.left))))/150,10)).get(0),[e.data.preview]);return false},aj=function(e){aa(e.data.cal.data("colorpicker").color,e.data.cal.get(0));aE(e.data.cal.data("colorpicker").color,e.data.cal.get(0));c(document).unbind("mouseup",aj);c(document).unbind("mousemove",au);return false},ao=function(e){c(this).addClass("colorpicker_focus")},T=function(e){c(this).removeClass("colorpicker_focus")},av=function(f){var e=c(this).parent();var g=e.data("colorpicker").color;e.data("colorpicker").origColor=g;aD(g,e.get(0));e.data("colorpicker").onSubmit(g,b(g),aB(g),e.data("colorpicker").el)},ag=function(h){var j=c("#"+c(this).data("colorpickerId"));j.data("colorpicker").onBeforeShow.apply(this,[j.get(0)]);var i=c(this).offset();var e=ak();var f=i.top+this.offsetHeight;var g=i.left;if(f+176>e.t+e.h){f-=this.offsetHeight+176}if(g+356>e.l+e.w){g-=356}j.css({left:g+"px",top:f+"px"});if(j.data("colorpicker").onShow.apply(this,[j.get(0)])!=false){j.show()}c(document).bind("mousedown",{cal:j},V);return false},V=function(e){if(!ac(e.data.cal.get(0),e.target,e.data.cal.get(0))){if(e.data.cal.data("colorpicker").onHide.apply(this,[e.data.cal.get(0)])!=false){e.data.cal.hide()}c(document).unbind("mousedown",V)}},ac=function(f,g,h){if(f==g){return true}if(f.contains){return f.contains(g)}if(f.compareDocumentPosition){return !!(f.compareDocumentPosition(g)&16)}var e=g.parentNode;while(e&&e!=h){if(e==f){return true}e=e.parentNode}return false},ak=function(){var e=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},aF=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},X=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},al=function(f){var h=6-f.length;if(h>0){var e=[];for(var g=0;g<h;g++){e.push("0")}e.push(f);f=e.join("")}return f},aH=function(e){var e=parseInt(((e.indexOf("#")>-1)?e.substring(1):e),16);return{r:e>>16,g:(e&65280)>>8,b:(e&255)}},ay=function(e){return aC(aH(e))},aC=function(f){var g={h:0,s:0,b:0};var e=Math.min(f.r,f.g,f.b);var h=Math.max(f.r,f.g,f.b);var i=h-e;g.b=h;if(h!=0){}g.s=h!=0?255*i/h:0;if(g.s!=0){if(f.r==h){g.h=(f.g-f.b)/i}else{if(f.g==h){g.h=2+(f.b-f.r)/i}else{g.h=4+(f.r-f.g)/i}}}else{g.h=-1}g.h*=60;if(g.h<0){g.h+=360}g.s*=100/255;g.b*=100/255;return g},aB=function(h){var f={};var j=Math.round(h.h);var k=Math.round(h.s*255/100);var g=Math.round(h.b*255/100);if(k==0){f.r=f.g=f.b=g}else{var i=g;var l=(255-k)*g/255;var e=(i-l)*(j%60)/60;if(j==360){j=0}if(j<60){f.r=i;f.b=l;f.g=l+e}else{if(j<120){f.g=i;f.b=l;f.r=i-e}else{if(j<180){f.g=i;f.r=l;f.b=l+e}else{if(j<240){f.b=i;f.r=l;f.g=i-e}else{if(j<300){f.b=i;f.g=l;f.r=l+e}else{if(j<360){f.r=i;f.g=l;f.b=i-e}else{f.r=0;f.g=0;f.b=0}}}}}}}return{r:Math.round(f.r),g:Math.round(f.g),b:Math.round(f.b)}},ah=function(f){var e=[f.r.toString(16),f.g.toString(16),f.b.toString(16)];c.each(e,function(h,g){if(g.length==1){e[h]="0"+g}});return e.join("")},b=function(e){return ah(aB(e))},ae=function(){var e=c(this).parent();var f=e.data("colorpicker").origColor;e.data("colorpicker").color=f;aa(f,e.get(0));aE(f,e.get(0));ap(f,e.get(0));az(f,e.get(0));ad(f,e.get(0));af(f,e.get(0))};return{init:function(e){e=c.extend({},ai,e||{});if(typeof e.color=="string"){e.color=ay(e.color)}else{if(e.color.r!=undefined&&e.color.g!=undefined&&e.color.b!=undefined){e.color=aC(e.color)}else{if(e.color.h!=undefined&&e.color.s!=undefined&&e.color.b!=undefined){e.color=aF(e.color)}else{return this}}}return this.each(function(){if(!c(this).data("colorpickerId")){var h=c.extend({},e);h.origColor=e.color;var f="collorpicker_"+parseInt(Math.random()*1000);c(this).data("colorpickerId",f);var g=c(U).attr("id",f);if(h.flat){g.appendTo(this).show()}else{g.appendTo(document.body)}h.fields=g.find("input").bind("keyup",ax).bind("change",aG).bind("blur",aw).bind("focus",Z);g.find("span").bind("mousedown",ab).end().find(">div.colorpicker_current_color").bind("click",ae);h.selector=g.find("div.colorpicker_color").bind("mousedown",am);h.selectorIndic=h.selector.find("div div");h.el=this;h.hue=g.find("div.colorpicker_hue div");g.find("div.colorpicker_hue").bind("mousedown",an);h.newColor=g.find("div.colorpicker_new_color");h.currentColor=g.find("div.colorpicker_current_color");g.data("colorpicker",h);g.find("div.colorpicker_submit").bind("mouseenter",ao).bind("mouseleave",T).bind("click",av);aa(h.color,g.get(0));ap(h.color,g.get(0));aE(h.color,g.get(0));ad(h.color,g.get(0));az(h.color,g.get(0));aD(h.color,g.get(0));af(h.color,g.get(0));if(h.flat){g.css({position:"relative",display:"block"})}else{c(this).bind(h.eventName,ag)}}})},showPicker:function(){return this.each(function(){if(c(this).data("colorpickerId")){ag.apply(this)}})},hidePicker:function(){return this.each(function(){if(c(this).data("colorpickerId")){c("#"+c(this).data("colorpickerId")).hide()}})},setColor:function(e){if(typeof e=="string"){e=ay(e)}else{if(e.r!=undefined&&e.g!=undefined&&e.b!=undefined){e=aC(e)}else{if(e.h!=undefined&&e.s!=undefined&&e.b!=undefined){e=aF(e)}else{return this}}}return this.each(function(){if(c(this).data("colorpickerId")){var f=c("#"+c(this).data("colorpickerId"));f.data("colorpicker").color=e;f.data("colorpicker").origColor=e;aa(e,f.get(0));ap(e,f.get(0));aE(e,f.get(0));ad(e,f.get(0));az(e,f.get(0));aD(e,f.get(0));af(e,f.get(0))}})}}}();c.fn.extend({ColorPicker:d.init,ColorPickerHide:d.hidePicker,ColorPickerShow:d.showPicker,ColorPickerSetColor:d.setColor})})(jQuery);